# –†–µ–∑—é–º–µ —É–ø—Ä–æ—â–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Qwen Workflow

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£–¥–∞–ª–µ–Ω Factory Pattern
- ‚ùå –£–¥–∞–ª–µ–Ω `worker/workflows/__init__.py` (—Ñ—É–Ω–∫—Ü–∏—è `get_workflow`)
- ‚ùå –£–¥–∞–ª–µ–Ω `worker/workflows/standard.py` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- ‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ `worker/workflows/qwen_edit_2511.py`

### 2. –£–ø—Ä–æ—â–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è workflow
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_qwen_edit_2511_workflow()` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –≤ `build_workflow(job)`
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –≤—Å—è –ª–æ–≥–∏–∫–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (lines 21-32 –≤ qwen_edit_2511.py)
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏–Ω—ã:
  - `scale_megapixels = 2`
  - `steps = 20`
  - `cfg = 1`, `denoise = 1` (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ workflow)

### 3. –£–ø—Ä–æ—â–µ–Ω–∞ Job –º–æ–¥–µ–ª—å
- ‚ùå –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `workflow_type` –∏–∑ Job
- ‚ùå –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `workflow_config` –∏–∑ Job
- ‚úÖ Job —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ: `id`, `user_id`, `image_path`, `prompt`, `status`, `result_path`, `error`, `retry_count`

### 4. –£–ø—Ä–æ—â–µ–Ω–∞ Preset –º–æ–¥–µ–ª—å
- ‚ùå –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `workflow_type` –∏–∑ Preset
- ‚úÖ Preset —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ: `prompt`, `price`, `name`, `category`, `icon`, `order`

### 5. –û–±–Ω–æ–≤–ª–µ–Ω ImageEditorProcessor
- ‚úÖ –£–±—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç `get_workflow`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `build_workflow`
- ‚úÖ –°—Ç—Ä–æ–∫–∞ 52: –≤–º–µ—Å—Ç–æ `workflow = get_workflow(job.workflow_type, job)`
- ‚úÖ –¢–µ–ø–µ—Ä—å: `workflow = build_workflow(job)`

### 6. –û–±–Ω–æ–≤–ª–µ–Ω—ã Pydantic —Å—Ö–µ–º—ã
- ‚úÖ JobCreate: —Ç–æ–ª—å–∫–æ `user_id`, `image_path`, `prompt`
- ‚úÖ –£–±—Ä–∞–Ω—ã `workflow_type`, `workflow_config`

### 7. –û–±–Ω–æ–≤–ª–µ–Ω Backend API
- ‚úÖ POST `/api/jobs/create` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ: `image_file`, `prompt` (–∏ `user_id`)
- ‚úÖ –£–±—Ä–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `workflow_type` –∏ `preset_id`

### 8. –û–±–Ω–æ–≤–ª–µ–Ω Bot
- ‚úÖ –í `bot/handlers/image_upload.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –ø—Ä–µ—Å–µ—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_preset_prompt()` –≤ BackendAPIClient
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω –º–µ—Ç–æ–¥ `create_job()` - —Ç–æ–ª—å–∫–æ —Å prompt

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

- **–ö–æ–¥ –ø—Ä–æ—â–µ –≤ 2 —Ä–∞–∑–∞** - —É–±—Ä–∞–Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞
- **–ù–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏–Ω—ã
- **–†–∞–±–æ—Ç–∞–µ—Ç Qwen workflow** - —Ñ–æ—Ç–æ + –ø—Ä–æ–º–ø—Ç ‚Üí ComfyUI ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí Telegram
- **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å workflow** - –ø—Ä–æ—Å—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º JSON –≤ `qwen_edit_2511.py`

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω

1. ‚úÖ –ù–µ—Ç –∏–º–ø–æ—Ä—Ç–∞ `get_workflow` –Ω–∏–≥–¥–µ –≤ –∫–æ–¥–µ (grep –ø—Ä–æ–≤–µ—Ä–∫–∞)
2. ‚úÖ Job –º–æ–¥–µ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
3. ‚úÖ Worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç: —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ ‚Üí hardcoded Qwen workflow —Å –ø—Ä–æ–º–ø—Ç–æ–º ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí Telegram
4. ‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚ùå `/worker/workflows/__init__.py` - –£–î–ê–õ–ï–ù
2. ‚ùå `/worker/workflows/standard.py` - –£–î–ê–õ–ï–ù
3. ‚úÖ `/worker/workflows/qwen_edit_2511.py` - –ü–ï–†–ï–†–ê–ë–û–¢–ê–ù
4. ‚úÖ `/worker/processors/image_editor.py` - –û–ë–ù–û–í–õ–ï–ù
5. ‚úÖ `/backend/app/models.py` - –£–î–ê–õ–ï–ù–´ –ø–æ–ª—è workflow_type, workflow_config
6. ‚úÖ `/backend/app/schemas.py` - –û–ë–ù–û–í–õ–ï–ù JobCreate
7. ‚úÖ `/bot/handlers/image_upload.py` - –û–ë–ù–û–í–õ–ï–ù (—É–±—Ä–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã workflow)
8. ‚úÖ `/bot/services/api_client.py` - –û–ë–ù–û–í–õ–ï–ù create_job –º–µ—Ç–æ–¥
9. ‚úÖ `/backend/app/api/jobs.py` - –û–ë–ù–û–í–õ–ï–ù POST /api/jobs/create

## üöÄ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- Backend API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ + –ø—Ä–æ–º–ø—Ç
- Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Qwen workflow
- Bot –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ + –ø—Ä–æ–º–ø—Ç (–ø—Ä–µ—Å–µ—Ç—ã —á–µ—Ä–µ–∑ prompt)
- –í—Å–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–ª—è –∏ –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω—ã