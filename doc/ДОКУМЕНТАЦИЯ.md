# QwenEditBot - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
4. [Backend API](#backend-api)
5. [Telegram Bot](#telegram-bot)
6. [Worker —Å–∏—Å—Ç–µ–º–∞](#worker-—Å–∏—Å—Ç–µ–º–∞)
7. [–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞](#–ø–ª–∞—Ç–µ–∂–Ω–∞—è-—Å–∏—Å—Ç–µ–º–∞)
8. [API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫](#api-—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
9. [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
10. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
11. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)
12. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–≤-–ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
13. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã](#—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-—Å–∏—Å—Ç–µ–º—ã)
14. [–õ–∏—Ü–µ–Ω–∑–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞](#–ª–∏—Ü–µ–Ω–∑–∏—è-–∏-–ø–æ–¥–¥–µ—Ä–∂–∫–∞)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

**QwenEditBot** ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å Telegram –±–æ—Ç–æ–º. –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ ComfyUI –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ü§ñ **–ò–ò-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ComfyUI –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üí¨ **Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –£–¥–æ–±–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç
- üí∞ **–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YuKassa –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚ö° **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á –≤–æ—Ä–∫–µ—Ä–æ–º
- üìä **–ë–∞–ª–∞–Ω—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π –≤–µ–±—Ö—É–∫–æ–≤ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram Bot  ‚îÇ    ‚îÇ   Backend API   ‚îÇ    ‚îÇ   Worker System ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ REST API      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∫–∞     ‚îÇ
‚îÇ ‚Ä¢ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å     ‚îÇ    ‚îÇ ‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö   ‚îÇ    ‚îÇ ‚Ä¢ ComfyUI       ‚îÇ
‚îÇ ‚Ä¢ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã    ‚îÇ    ‚îÇ ‚Ä¢ –õ–æ–≥–∏–∫–∞        ‚îÇ    ‚îÇ ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ   SQLite        ‚îÇ
                         ‚îÇ   ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏‚îÇ
                         ‚îÇ   ‚Ä¢ –ó–∞–¥–∞—á–∏      ‚îÇ
                         ‚îÇ   ‚Ä¢ –ü–ª–∞—Ç–µ–∂–∏     ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

#### 1. **Backend API** (FastAPI)
- REST API –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å SQLAlchemy ORM
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ComfyUI
- –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–º
- –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ YuKassa
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

#### 2. **Telegram Bot** (aiogram)
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- FSM (–∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π)
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (Reply –∏ Inline)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API

#### 3. **Worker System** (asyncio)
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPU –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ComfyUI
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### 4. **Database Models**
- **User**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- **Preset**: –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Job**: –ó–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
- **Payment**: –ü–ª–∞—Ç–µ–∂–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **PaymentLog**: –õ–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°**: Linux (Ubuntu 18.04+), macOS, Windows 10+
- **Python**: 3.8 –∏–ª–∏ –≤—ã—à–µ
- **RAM**: 4 –ì–ë
- **–î–∏—Å–∫**: 10 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **GPU**: NVIDIA GPU —Å CUDA (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°**: Ubuntu 20.04+ / CentOS 8+
- **Python**: 3.9+
- **RAM**: 8 –ì–ë+
- **–î–∏—Å–∫**: 50 –ì–ë+ SSD
- **GPU**: NVIDIA RTX 3060+ —Å 8 –ì–ë+ VRAM
- **ComfyUI**: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∏ pip
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3.9 python3.9-pip python3.9-venv

# CentOS/RHEL
sudo yum install python39 python39-pip

# macOS (—Å Homebrew)
brew install python@3.9
```

#### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ComfyUI
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/comfyanonymous/ComfyUI.git
cd ComfyUI

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–æ–¥–µ–ª–∏ –≤ –ø–∞–ø–∫—É models/
```

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞
1. –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

### –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone https://github.com/fegerV/QwenEditBot
cd QwenEditBot
```

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend
```bash
cd backend

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.9 -m venv venv
source venv/bin/activate  # Linux/macOS
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
```

#### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Backend
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `backend/.env`:

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
BOT_TOKEN=your_telegram_bot_token_here
SECRET_KEY=your-secret-key-here

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=sqlite:///./qwen.db

# ComfyUI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
COMFYUI_URL=http://127.0.0.1:8188
COMFY_INPUT_DIR=C:/ComfyUI/ComfyUI/input/bot
COMFYUI_TIMEOUT=300

# –ë–∞–ª–∞–Ω—Å
INITIAL_BALANCE=60
EDIT_COST=30
WEEKLY_BONUS=10

# YuKassa –ø–ª–∞—Ç–µ–∂–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
YUKASSA_SHOP_ID=your_shop_id
YUKASSA_API_KEY=your_api_key
YUKASSA_WEBHOOK_SECRET=your_webhook_secret
PAYMENT_MIN_AMOUNT=1
PAYMENT_MAX_AMOUNT=10000
POINTS_PER_RUBLE=100
WEEKLY_BONUS_ENABLED=true
WEEKLY_BONUS_AMOUNT=10
WEEKLY_BONUS_DAY=4
WEEKLY_BONUS_TIME=20:00
```

#### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bot
```bash
cd ../bot

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
```

#### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Bot
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `bot/.env`:

```env
# Telegram Bot
BOT_TOKEN=your_telegram_bot_token_here

# Backend API
BACKEND_API_URL=http://localhost:8000
BACKEND_API_TIMEOUT=30

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–ª–∞–Ω—Å–∞
INITIAL_BALANCE=60
EDIT_COST=30
```

#### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Worker
```bash
cd ../worker

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
```

#### –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Worker
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `worker/.env`:

```env
# Backend API
BACKEND_API_URL=http://localhost:8000
BACKEND_API_TIMEOUT=60

# ComfyUI
COMFYUI_URL=http://127.0.0.1:8188
COMFYUI_TIMEOUT=300
COMFYUI_POLL_INTERVAL=0.5
COMFY_INPUT_DIR=C:/ComfyUI/ComfyUI/input/bot
COMFY_OUTPUT_DIR=C:/ComfyUI/ComfyUI/output/bot

# Telegram
BOT_TOKEN=your_telegram_bot_token_here

# Worker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
WORKER_POLLING_INTERVAL=2
WORKER_GPU_LOCK_TIMEOUT=30
WORKER_LOG_LEVEL=INFO

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
MAX_RETRIES=3
RETRY_DELAYS=5,10,20

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
RESULTS_DIR=./results
```

#### –®–∞–≥ 8: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - Backend:**
```bash
cd backend
source venv/bin/activate  # –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python run.py
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - Worker:**
```bash
cd worker
source venv/bin/activate  # –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python run.py
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 3 - Bot:**
```bash
cd bot
source venv/bin/activate  # –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python run.py
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
1. Backend –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`
2. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8000/docs` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`

---

## Backend API

Backend –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ FastAPI –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ Backend

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py           # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ api/                 # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ presets.py       # –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jobs.py          # –ó–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ balance.py       # –ë–∞–ª–∞–Ω—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments.py      # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhooks.py      # –í–µ–±—Ö—É–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comfyui.py       # ComfyUI –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ balance.py       # –õ–æ–≥–∏–∫–∞ –±–∞–ª–∞–Ω—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments.py      # –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ yukassa.py       # YuKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram.py      # Telegram –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ scheduler.py     # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ logging.py       # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ security.py      # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ run.py
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
```python
class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True, index=True)
    telegram_id = Column(Integer, unique=True, index=True)
    username = Column(String(100))
    balance = Column(Integer, default=60)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # –°–≤—è–∑–∏
    jobs = relationship("Job", back_populates="user")
    payments = relationship("Payment", back_populates="user")
```

#### Preset (–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
```python
class Preset(Base):
    __tablename__ = "presets"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String(200), index=True)
    description = Column(Text)
    category = Column(String(50), index=True)  # Styles, Lighting, Design
    prompt = Column(Text)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # –°–≤—è–∑–∏
    jobs = relationship("Job", back_populates="preset")
```

#### Job (–ó–∞–¥–∞—á–∞)
```python
class Job(Base):
    __tablename__ = "jobs"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), index=True)
    preset_id = Column(Integer, ForeignKey("presets.id"), nullable=True)
    custom_prompt = Column(Text, nullable=True)
    status = Column(String(20), index=True)  # queued, processing, completed, failed
    image_path = Column(String(500))
    result_path = Column(String(500), nullable=True)
    error_message = Column(Text, nullable=True)
    retry_count = Column(Integer, default=0)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # –°–≤—è–∑–∏
    user = relationship("User", back_populates="jobs")
    preset = relationship("Preset", back_populates="jobs")
```

#### Payment (–ü–ª–∞—Ç–µ–∂)
```python
class Payment(Base):
    __tablename__ = "payments"
    
    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("users.id"), index=True)
    amount_kopeks = Column(Integer)  # –°—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
    amount_rubles = Column(Integer)  # –°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö
    yukassa_payment_id = Column(String(100), unique=True)
    status = Column(String(20), index=True)  # pending, succeeded, failed, cancelled
    payment_type = Column(String(20), index=True)  # payment, weekly_bonus, refund
    description = Column(String(200))
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    
    # –°–≤—è–∑–∏
    user = relationship("User", back_populates="payments")
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### ComfyUI Service
```python
class ComfyUIService:
    async def upload_image(self, image_path: str) -> str:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ ComfyUI"""
        
    async def submit_job(self, image_id: str, prompt: str, preset_id: int) -> str:
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É"""
        
    async def check_status(self, job_id: str) -> str:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏"""
        
    async def get_result(self, job_id: str) -> bytes:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"""
```

#### Payment Service
```python
class PaymentService:
    async def create_payment(self, user_id: int, amount_rubles: int) -> Payment:
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞"""
        
    async def handle_webhook(self, webhook_data: dict) -> None:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–∞ YuKassa"""
        
    async def issue_weekly_bonus(self) -> None:
        """–í—ã–¥–∞—á–∞ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞"""
        
    async def refund_payment(self, job_id: int) -> Payment:
        """–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ –Ω–µ—É–¥–∞—á–Ω—É—é –∑–∞–¥–∞—á—É"""
```

---

## Telegram Bot

Telegram –±–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–∏—Å—Ç–µ–º—ã QwenEditBot.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
bot/
‚îú‚îÄ‚îÄ main.py                 # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ states.py              # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îú‚îÄ‚îÄ keyboards.py           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ utils.py              # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ handlers/             # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ start.py          # –ö–æ–º–∞–Ω–¥—ã /start, /help
‚îÇ   ‚îú‚îÄ‚îÄ menu.py           # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îú‚îÄ‚îÄ presets.py        # –í—ã–±–æ—Ä –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ custom_prompt.py  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ image_upload.py   # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ balance.py        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ payments.py       # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îî‚îÄ‚îÄ help.py           # –ü–æ–º–æ—â—å
‚îî‚îÄ‚îÄ services/             # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
    ‚îî‚îÄ‚îÄ api_client.py     # –ö–ª–∏–µ–Ω—Ç Backend API
```

### FSM (Finite State Machine)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
class UserState(StatesGroup):
    main_menu = State()                    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    select_preset_category = State()        # –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
    select_preset = State()                # –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏
    awaiting_image_for_preset = State()   # –û–∂–∏–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
    awaiting_custom_prompt = State()       # –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
    awaiting_image_for_custom = State()    # –û–∂–∏–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç)
    awaiting_payment = State()             # –í –º–µ–Ω—é –ø–ª–∞—Ç–µ–∂–µ–π
    processing_job = State()                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

#### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (ReplyKeyboard)
```python
MAIN_MENU_KEYBOARD = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üé® –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ")],
        [KeyboardButton(text="üß© –°—Ç–∏–ª–∏"), KeyboardButton(text="üí° –û—Å–≤–µ—â–µ–Ω–∏–µ")],
        [KeyboardButton(text="üñº –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ"), KeyboardButton(text="‚úçÔ∏è –°–≤–æ–π –ø—Ä–æ–º–ø—Ç")],
        [KeyboardButton(text="üí∞ –ë–∞–ª–∞–Ω—Å"), KeyboardButton(text="‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å")],
        [KeyboardButton(text="‚ÑπÔ∏è –ü–æ–º–æ—â—å")]
    ],
    resize_keyboard=True
)
```

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫ (InlineKeyboard)
```python
PRESET_CATEGORIES_KEYBOARD = InlineKeyboardMarkup(
    inline_keyboard=[
        [InlineKeyboardButton(text="üß© –°—Ç–∏–ª–∏", callback_data="category_styles")],
        [InlineKeyboardButton(text="üí° –û—Å–≤–µ—â–µ–Ω–∏–µ", callback_data="category_lighting")],
        [InlineKeyboardButton(text="üñº –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ", callback_data="category_design")],
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_menu")]
    ]
)
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
```python
@router.message(Command("start"))
async def cmd_start(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start"""
    user_id = message.from_user.id
    
    try:
        # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await api_client.register_user(user_id, message.from_user.username)
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        await message.answer(
            "üé® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ QwenEditBot!\n\n"
            "–Ø –ø–æ–º–æ–≥—É –≤–∞–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å –ø–æ–º–æ—â—å—é –ò–ò.\n"
            "–ù–∞—á–Ω–∏—Ç–µ —Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å—Ç–∏–ª—å.",
            reply_markup=MAIN_MENU_KEYBOARD
        )
        
        await state.set_state(UserState.main_menu)
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {e}")
```

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```python
@router.message(UserState.awaiting_image_for_preset, ContentType.PHOTO)
async def process_image_preset(message: Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏"""
    user_id = message.from_user.id
    
    try:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è
        data = await state.get_data()
        preset_id = data.get('preset_id')
        
        # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        photo = message.photo[-1]
        file = await bot.get_file(photo.file_id)
        image_bytes = await file.download_as_bytearray()
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        job = await api_client.create_job(user_id, preset_id, image_bytes)
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        await message.answer(
            "‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ! –ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É...\n"
            f"üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 30 –±–∞–ª–ª–æ–≤\n"
            f"üÜî ID –∑–∞–¥–∞—á–∏: {job.id}",
            reply_markup=MAIN_MENU_KEYBOARD
        )
        
        await state.set_state(UserState.processing_job)
        
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ: {e}")
        await state.set_state(UserState.main_menu)
```

---

## Worker —Å–∏—Å—Ç–µ–º–∞

Worker –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ñ–æ–Ω–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å ComfyUI.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Worker

```
worker/
‚îú‚îÄ‚îÄ main.py                 # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ gpu/
‚îÇ   ‚îî‚îÄ‚îÄ lock.py            # GPU –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
‚îú‚îÄ‚îÄ queue/
‚îÇ   ‚îî‚îÄ‚îÄ job_queue.py       # –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ processors/
‚îÇ   ‚îú‚îÄ‚îÄ image_editor.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ result_handler.py  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ retry/
‚îÇ   ‚îî‚îÄ‚îÄ strategy.py        # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ backend_client.py  # –ö–ª–∏–µ–Ω—Ç Backend API
‚îÇ   ‚îú‚îÄ‚îÄ comfyui_client.py  # –ö–ª–∏–µ–Ω—Ç ComfyUI
‚îÇ   ‚îî‚îÄ‚îÄ telegram_client.py # –ö–ª–∏–µ–Ω—Ç Telegram
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ logger.py          # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª Worker

```python
async def worker_main():
    """–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≤–æ—Ä–∫–µ—Ä–∞"""
    logger.info("–ó–∞–ø—É—Å–∫ Worker —Å–∏—Å—Ç–µ–º—ã...")
    
    while True:
        try:
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
            job = await backend_client.get_next_job()
            
            if job:
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏
                await process_job(job)
            else:
                # –û–∂–∏–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
                await asyncio.sleep(config.WORKER_POLLING_INTERVAL)
                
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ: {e}")
            await asyncio.sleep(5)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á

```python
async def process_job(job: Job):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏"""
    job_id = job.id
    
    try:
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "processing"
        await backend_client.update_job_status(job_id, "processing")
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ GPU –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        async with gpu_lock.acquire():
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            result_path = await process_image(job)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "completed"
            await backend_client.update_job_status(job_id, "completed", result_path)
            
            # –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            await send_result_to_user(job, result_path)
            
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–¥–∞—á–∏ {job_id}: {e}")
        
        # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏–ª–∏ –Ω–µ—É–¥–∞—á–∞
        if job.retry_count < config.MAX_RETRIES:
            await retry_job(job)
        else:
            await fail_job(job, str(e))
```

### GPU Lock —Å–∏—Å—Ç–µ–º–∞

```python
class GPULock:
    def __init__(self, lock_file: str = "/tmp/gpu.lock"):
        self.lock_file = lock_file
    
    async def acquire(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ GPU"""
        while True:
            try:
                # –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å lock —Ñ–∞–π–ª
                with open(self.lock_file, 'x') as f:
                    f.write(str(os.getpid()))
                return GPULockContext(self.lock_file)
            except FileExistsError:
                # –§–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∂–¥–µ–º
                await asyncio.sleep(1)
    
    async def release(self):
        """–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ GPU"""
        if os.path.exists(self.lock_file):
            os.remove(self.lock_file)
```

### –°–∏—Å—Ç–µ–º–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

```python
class RetryStrategy:
    def __init__(self, max_retries: int = 3, delays: List[int] = None):
        self.max_retries = max_retries
        self.delays = delays or [5, 10, 20]  # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    
    async def execute_with_retry(self, func, *args, **kwargs):
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
        for attempt in range(self.max_retries + 1):
            try:
                return await func(*args, **kwargs)
            except Exception as e:
                if attempt == self.max_retries:
                    raise e
                
                delay = self.delays[min(attempt, len(self.delays) - 1)]
                logger.warning(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1} –Ω–µ—É–¥–∞—á–Ω–∞, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ {delay}—Å: {e}")
                await asyncio.sleep(delay)
```

---

## –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å YuKassa –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

```
–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram  ‚îÇ    ‚îÇ   Backend   ‚îÇ    ‚îÇ  YuKassa    ‚îÇ
‚îÇ     Bot     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ     API     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Gateway   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ  Webhook    ‚îÇ
                   ‚îÇ  Handler    ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### YuKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
```python
async def create_payment(user_id: int, amount_rubles: int) -> Payment:
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ YuKassa"""
    
    payment_data = {
        "amount": {
            "value": str(amount_rubles),
            "currency": "RUB"
        },
        "capture": True,
        "confirmation": {
            "type": "redirect",
            "return_url": config.PAYMENT_RETURN_URL
        },
        "description": f"–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}"
    }
    
    response = await yukassa_client.create_payment(payment_data)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    payment = Payment(
        user_id=user_id,
        amount_rubles=amount_rubles,
        amount_kopeks=amount_rubles * 100,
        yukassa_payment_id=response['id'],
        status="pending",
        payment_type="payment",
        description=f"–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ {amount_rubles}‚ÇΩ"
    )
    
    db.add(payment)
    db.commit()
    
    return payment
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤
```python
async def handle_yukassa_webhook(webhook_data: dict):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–∞ –æ—Ç YuKassa"""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
    if not verify_webhook_signature(webhook_data):
        logger.error("–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –≤–µ–±—Ö—É–∫–∞")
        return
    
    event = webhook_data['event']
    payment_data = webhook_data['object']
    
    payment_id = payment_data['id']
    status = payment_data['status']
    
    # –ü–æ–∏—Å–∫ –ø–ª–∞—Ç–µ–∂–∞ –≤ –±–∞–∑–µ
    payment = db.query(Payment).filter(
        Payment.yukassa_payment_id == payment_id
    ).first()
    
    if not payment:
        logger.error(f"–ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω: {payment_id}")
        return
    
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    payment.status = status
    payment.updated_at = datetime.utcnow()
    
    if status == "succeeded":
        # –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤
        points_to_add = payment.amount_rubles * config.POINTS_PER_RUBLE
        
        user = db.query(User).filter(User.id == payment.user_id).first()
        user.balance += points_to_add
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await telegram_client.send_message(
            payment.user_id,
            f"‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!\n"
            f"üí∞ –ù–∞—á–∏—Å–ª–µ–Ω–æ –±–∞–ª–ª–æ–≤: {points_to_add}\n"
            f"üí≥ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {user.balance} –±–∞–ª–ª–æ–≤"
        )
        
        # –ó–∞–ø–∏—Å—å –≤ –ª–æ–≥
        log_payment_event(payment, "payment_succeeded")
        
    db.commit()
```

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å

```python
async def issue_weekly_bonus():
    """–í—ã–¥–∞—á–∞ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞"""
    
    if not config.WEEKLY_BONUS_ENABLED:
        return
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
    now = datetime.utcnow()
    if now.weekday() != config.WEEKLY_BONUS_DAY:
        return
    
    if now.strftime("%H:%M") != config.WEEKLY_BONUS_TIME:
        return
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    users = db.query(User).all()
    
    bonus_amount = config.WEEKLY_BONUS_AMOUNT
    
    for user in users:
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –±–æ–Ω—É—Å–µ
            bonus_payment = Payment(
                user_id=user.id,
                amount_rubles=0,
                amount_kopeks=0,
                yukassa_payment_id=f"bonus_{user.id}_{now.timestamp()}",
                status="succeeded",
                payment_type="weekly_bonus",
                description=f"–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å: +{bonus_amount} –±–∞–ª–ª–æ–≤"
            )
            
            # –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤
            user.balance += bonus_amount
            
            # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await telegram_client.send_message(
                user.telegram_id,
                f"üéÅ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å!\n"
                f"üí∞ –ù–∞—á–∏—Å–ª–µ–Ω–æ: {bonus_amount} –±–∞–ª–ª–æ–≤\n"
                f"üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user.balance} –±–∞–ª–ª–æ–≤"
            )
            
            db.add(bonus_payment)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–¥–∞—á–µ –±–æ–Ω—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user.id}: {e}")
    
    db.commit()
    logger.info(f"–í—ã–¥–∞–Ω –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å {bonus_amount} –±–∞–ª–ª–æ–≤ {len(users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º")
```

### –¢–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|--------|
| `payment` | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—Ç–∏–ª 500‚ÇΩ |
| `weekly_bonus` | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ 10 –±–∞–ª–ª–æ–≤ |
| `refund` | –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ | –í–æ–∑–≤—Ä–∞—Ç –∑–∞ –Ω–µ—É–¥–∞—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É |

### –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `pending` | –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã |
| `succeeded` | –£—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω |
| `failed` | –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã |
| `cancelled` | –û—Ç–º–µ–Ω–µ–Ω |

---

## API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
POST /api/users/register
```

**Request Body:**
```json
{
  "telegram_id": 123456789,
  "username": "testuser"
}
```

**Response:**
```json
{
  "id": 1,
  "telegram_id": 123456789,
  "username": "testuser",
  "balance": 60,
  "created_at": "2024-01-01T00:00:00"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
```
GET /api/users/{user_id}
```

**Response:**
```json
{
  "id": 1,
  "telegram_id": 123456789,
  "username": "testuser",
  "balance": 60,
  "created_at": "2024-01-01T00:00:00"
}
```

### –ë–∞–ª–∞–Ω—Å

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
```
GET /api/balance/{user_id}
```

**Response:**
```json
{
  "user_id": 1,
  "balance": 60
}
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
```
POST /api/balance/{user_id}/check
```

**Request Body:**
```json
{
  "required_points": 30
}
```

**Response:**
```json
{
  "sufficient": true,
  "current_balance": 60,
  "required_points": 30
}
```

### –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
```
GET /api/presets
```

**Response:**
```json
[
  {
    "id": 1,
    "name": "–°—Ç–∏–ª—å –º–∞—Å–ª–æ–º",
    "description": "–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ç–æ –≤ –∫–∞—Ä—Ç–∏–Ω—É –º–∞—Å–ª–æ–º",
    "category": "Styles",
    "prompt": "oil painting style, artistic, beautiful",
    "is_active": true
  }
]
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```
GET /api/presets?category=Styles
```

### –ó–∞–¥–∞—á–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
```
POST /api/jobs/create
```

**Parameters:**
- `user_id` (query): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `preset_id` (query): ID –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `custom_prompt` (query): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `image_file` (multipart): –§–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**Response:**
```json
{
  "id": 1,
  "user_id": 1,
  "preset_id": 1,
  "status": "queued",
  "created_at": "2024-01-01T00:00:00"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
```
GET /api/jobs/{job_id}
```

**Response:**
```json
{
  "id": 1,
  "user_id": 1,
  "status": "processing",
  "image_path": "/path/to/image.jpg",
  "result_path": null,
  "error_message": null,
  "retry_count": 0,
  "created_at": "2024-01-01T00:00:00",
  "updated_at": "2024-01-01T00:00:00"
}
```

### –ü–ª–∞—Ç–µ–∂–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
```
POST /api/payments/create
```

**Request Body:**
```json
{
  "user_id": 1,
  "amount": 100
}
```

**Response:**
```json
{
  "payment_id": 1,
  "confirmation_url": "https://yookassa.ru/pay/...",
  "amount": 100,
  "status": "pending"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
```
GET /api/payments/{payment_id}
```

**Response:**
```json
{
  "id": 1,
  "user_id": 1,
  "amount_rubles": 100,
  "status": "succeeded",
  "payment_type": "payment",
  "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ 100‚ÇΩ",
  "created_at": "2024-01-01T00:00:00"
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
GET /api/payments/user/{user_id}?limit=10&offset=0
```

**Response:**
```json
{
  "payments": [
    {
      "id": 1,
      "amount_rubles": 100,
      "status": "succeeded",
      "payment_type": "payment",
      "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ 100‚ÇΩ",
      "created_at": "2024-01-01T00:00:00"
    }
  ],
  "total": 1,
  "has_more": false
}
```

### –í–µ–±—Ö—É–∫–∏

#### YuKassa –≤–µ–±—Ö—É–∫
```
POST /api/webhooks/yukassa
```

**Headers:**
- `Content-Type: application/json`
- `Signature: <HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å>`

**Request Body:**
```json
{
  "type": "payment.succeeded",
  "event": "payment.succeeded",
  "object": {
    "id": "216749f4-001f-50be-b000-000000000001",
    "status": "succeeded",
    "amount": {
      "value": "100.00",
      "currency": "RUB"
    },
    "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 1"
  }
}
```

---

## –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

#### 1. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ 60 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –±–∞–ª–ª–æ–≤

#### 2. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```
üé® –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ
üß© –°—Ç–∏–ª–∏          üí° –û—Å–≤–µ—â–µ–Ω–∏–µ
üñº –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ     ‚úçÔ∏è –°–≤–æ–π –ø—Ä–æ–º–ø—Ç
üí∞ –ë–∞–ª–∞–Ω—Å         ‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å
‚ÑπÔ∏è –ü–æ–º–æ—â—å
```

### –°–ø–æ—Å–æ–±—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫

1. **–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:**
   - üß© –°—Ç–∏–ª–∏ - —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏
   - üí° –û—Å–≤–µ—â–µ–Ω–∏–µ - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å–≤–µ—â–µ–Ω–∏—è
   - üñº –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ - —Ä–∞–º–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã

2. **–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫—É**

3. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ (JPG, PNG)
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë

4. **–û–∂–∏–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 30-60 —Å–µ–∫—É–Ω–¥
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: 30 –±–∞–ª–ª–æ–≤

#### –°–ø–æ—Å–æ–± 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç

1. **–ù–∞–∂–º–∏—Ç–µ "‚úçÔ∏è –°–≤–æ–π –ø—Ä–æ–º–ø—Ç"**

2. **–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ:**
   ```
   –ü—Ä–µ–≤—Ä–∞—Ç–∏ —Ñ–æ—Ç–æ –≤ –∫–∞—Ä—Ç–∏–Ω—É –≤ —Å—Ç–∏–ª–µ –í–∞–Ω –ì–æ–≥–∞
   ```

3. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**

4. **–û–∂–∏–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –ù–∞–∂–º–∏—Ç–µ "üí∞ –ë–∞–ª–∞–Ω—Å"
- –£–∑–Ω–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤

#### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
1. –ù–∞–∂–º–∏—Ç–µ "‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å"
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É:
   - 100‚ÇΩ (10,000 –±–∞–ª–ª–æ–≤)
   - 250‚ÇΩ (25,000 –±–∞–ª–ª–æ–≤)
   - 500‚ÇΩ (50,000 –±–∞–ª–ª–æ–≤)
   - 1000‚ÇΩ (100,000 –±–∞–ª–ª–æ–≤)
   - –°–≤–æ—è —Å—É–º–º–∞ (1-10,000‚ÇΩ)
3. –û–ø–ª–∞—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ YuKassa
4. –ë–∞–ª–ª—ã –∑–∞—á–∏—Å–ª—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
1. –í –º–µ–Ω—é –±–∞–ª–∞–Ω—Å–∞ –Ω–∞–∂–º–∏—Ç–µ "üìú –ò—Å—Ç–æ—Ä–∏—è"
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
   - ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
   - ‚è≥ –û–∂–∏–¥–∞—é—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏
   - ‚ùå –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
   - üéÅ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∫–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É –≤ 20:00 –ú–°–ö
- **–°—É–º–º–∞**: 10 –±–∞–ª–ª–æ–≤
- **–£—Å–ª–æ–≤–∏—è**: –ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –ü—Ä–∏—Ö–æ–¥–∏—Ç –≤ Telegram

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

#### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
- `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- `/menu` - –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/balance` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å

#### –†–∞–∑–¥–µ–ª –ø–æ–º–æ—â–∏
- –ù–∞–∂–º–∏—Ç–µ "‚ÑπÔ∏è –ü–æ–º–æ—â—å" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
- –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**–í: –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞?**
–û: 30 –±–∞–ª–ª–æ–≤ –∑–∞ –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

**–í: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞?**
–û: –û–±—ã—á–Ω–æ 30-60 —Å–µ–∫—É–Ω–¥, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

**–í: –ö–∞–∫–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?**
–û: JPG, JPEG, PNG. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë.

**–í: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å?**
–û: –ë–∞–ª–ª—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.

**–í: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É?**
–û: –ü–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –Ω–µ–ª—å–∑—è.

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start
User: /start

# 2. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
Bot: üé® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ QwenEditBot!
     –£ –≤–∞—Å –µ—Å—Ç—å 60 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã!

# 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç–∏–ª—å
User: üß© –°—Ç–∏–ª–∏

# 4. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∏–ª–∏
Bot: –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å:
     [–°—Ç–∏–ª—å –º–∞—Å–ª–æ–º] [–ê–∫–≤–∞—Ä–µ–ª—å] [–í–∏–Ω—Ç–∞–∂]
     [–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π] [–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π]

# 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–°—Ç–∏–ª—å –º–∞—Å–ª–æ–º"
User: –°—Ç–∏–ª—å –º–∞—Å–ª–æ–º

# 6. –ë–æ—Ç –ø—Ä–æ—Å–∏—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
Bot: üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å—Ç–∏–ª–µ –º–∞—Å–ª–æ–º

# 7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ]

# 8. –ë–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ
Bot: ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ! –ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É...
     üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 30 –±–∞–ª–ª–æ–≤
     üÜî ID –∑–∞–¥–∞—á–∏: 123

# 9. –ß–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤
Bot: üéâ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
     [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ]
     üí≥ –û—Å—Ç–∞–≤—à–∏–π—Å—è –±–∞–ª–∞–Ω—Å: 30 –±–∞–ª–ª–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

```bash
# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å
User: üí∞ –ë–∞–ª–∞–Ω—Å

# 2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
Bot: üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: 30 –±–∞–ª–ª–æ–≤
     üí∏ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏: 30 –±–∞–ª–ª–æ–≤

# 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø–æ–ø–æ–ª–Ω–∏—Ç—å
User: ‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å

# 4. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã
Bot: üí∞ –í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:
     [100‚ÇΩ] [250‚ÇΩ] [500‚ÇΩ] [1000‚ÇΩ] [–°–≤–æ—è —Å—É–º–º–∞]

# 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç 500‚ÇΩ
User: 500‚ÇΩ

# 6. –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É
Bot: üí≥ –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å—É–º–º—É 500‚ÇΩ
     –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã: https://yookassa.ru/pay/...
     
     ‚è≥ –û–∂–∏–¥–∞—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã...

# 7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ YuKassa

# 8. –ë–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂
Bot: ‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!
     üí∞ –ù–∞—á–∏—Å–ª–µ–Ω–æ: 50,000 –±–∞–ª–ª–æ–≤
     üí≥ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: 50,030 –±–∞–ª–ª–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—à–∏–±–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

```bash
# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

# 2. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
Bot: ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ! –ù–∞—á–∏–Ω–∞—é –æ–±—Ä–∞–±–æ—Ç–∫—É...

# 3. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ –≤ ComfyUI
[Worker –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏]

# 4. –ë–æ—Ç —É–≤–µ–¥–æ–º–ª—è–µ—Ç –æ–± –æ—à–∏–±–∫–µ
Bot: ‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
     üîÑ –ü–æ–ø—Ä–æ–±—É—é –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥...

# 5. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Ç–∞–∫–∂–µ –Ω–µ—É–¥–∞—á–Ω–∞
Bot: ‚ùå –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å
     üí∞ –í–æ–∑–≤—Ä–∞—â–∞–µ–º 30 –±–∞–ª–ª–æ–≤ –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å
     üí≥ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: 60 –±–∞–ª–ª–æ–≤

# 6. –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
[–í –ª–æ–≥–∞—Ö: "–û—à–∏–±–∫–∞ ComfyUI: Invalid prompt parameters"]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å

```bash
# –í –ø—è—Ç–Ω–∏—Ü—É –≤ 20:00 –ú–°–ö —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏...

# 1. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—ã–¥–∞—á—É –±–æ–Ω—É—Å–æ–≤
[Worker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç process]

# 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
for user in all_users:
    # –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –æ –±–æ–Ω—É—Å–µ
    bonus = Payment(
        user_id=user.id,
        payment_type="weekly_bonus",
        amount=10
    )
    
    # –ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –±–∞–ª–ª—ã
    user.balance += 10
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    telegram.send_message(
        user.telegram_id,
        "üéÅ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å!"
        "üí∞ –ù–∞—á–∏—Å–ª–µ–Ω–æ: 10 –±–∞–ª–ª–æ–≤"
        "üí≥ –í–∞—à –±–∞–ª–∞–Ω—Å: {user.balance} –±–∞–ª–ª–æ–≤"
    )

# 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logger.info("–í—ã–¥–∞–Ω –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å 10 –±–∞–ª–ª–æ–≤ 15 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º")
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST "http://localhost:8000/api/users/register" \
  -H "Content-Type: application/json" \
  -d '{"telegram_id": 123456789, "username": "testuser"}'

# –û—Ç–≤–µ—Ç:
{
  "id": 1,
  "telegram_id": 123456789,
  "username": "testuser",
  "balance": 60,
  "created_at": "2024-01-01T00:00:00"
}

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
curl -X POST "http://localhost:8000/api/payments/create" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 1, "amount": 100}'

# –û—Ç–≤–µ—Ç:
{
  "payment_id": 1,
  "confirmation_url": "https://yookassa.ru/pay/...",
  "amount": 100,
  "status": "pending"
}

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
curl -X GET "http://localhost:8000/api/payments/1"

# –û—Ç–≤–µ—Ç:
{
  "id": 1,
  "user_id": 1,
  "amount_rubles": 100,
  "status": "succeeded",
  "payment_type": "payment",
  "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ 100‚ÇΩ"
}
```

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

#### Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞**: `Error: database is locked`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python
pkill -f "python.*run.py"

# 2. –£–¥–∞–ª–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª
rm -f backend/qwen.db-wal backend/qwen.db-shm

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend
cd backend && python run.py
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `Connection refused: localhost:8000`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ backend
ps aux | grep "python.*run.py"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f backend/logs/app.log

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç
netstat -tulpn | grep :8000
```

#### Bot –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞**: `Bot token is invalid`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ bot/.env
cat bot/.env | grep BOT_TOKEN

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞
curl -X GET "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getMe"

# 3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `Backend API unavailable`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
curl http://localhost:8000/health

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ bot/.env
cat bot/.env | grep BACKEND_API_URL

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ backend
```

#### Worker –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: `GPU lock timeout`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
ls -la /tmp/gpu.lock

# 2. –£–¥–∞–ª–∏—Ç–µ –∑–∞–≤–∏—Å—à—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
rm -f /tmp/gpu.lock

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ worker
cd worker && python run.py
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `ComfyUI connection failed`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ ComfyUI
curl http://localhost:8188/system_stats

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ worker/.env
cat worker/.env | grep COMFYUI_URL

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞
netstat -tulpn | grep :8188
```

#### –ü–ª–∞—Ç–µ–∂–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–æ–±–ª–µ–º–∞**: `YuKassa webhook verification failed`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤ backend/.env
cat backend/.env | grep YUKASSA_WEBHOOK_SECRET

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤–µ–±—Ö—É–∫–∞ –≤ YuKassa
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: https://yourdomain.com/api/webhooks/yukassa

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook handler
tail -f backend/logs/payments.log
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `Payment stuck in pending`
```bash
# –†–µ—à–µ–Ω–∏–µ:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ YuKassa dashboard
# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook
# 3. –í—Ä—É—á–Ω—É—é –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
sqlite3 backend/qwen.db
UPDATE payments SET status='succeeded' WHERE id=1;
```

### –õ–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Backend
```bash
# –í—Å–µ –ª–æ–≥–∏
tail -f backend/logs/app.log

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
tail -f backend/logs/error.log

# –õ–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–µ–π
tail -f backend/logs/payments.log
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Bot
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
tail -f bot/logs/bot.log

# –õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
tail -f bot/logs/handlers.log
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Worker
```bash
# –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–∞
tail -f worker/logs/worker.log

# –õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
tail -f worker/logs/image_processing.log
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
```bash
#!/bin/bash
# diagnostic.sh

echo "=== –°–æ—Å—Ç–æ—è–Ω–∏–µ Backend ==="
curl -s http://localhost:8000/health || echo "Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

echo -e "\n=== –°–æ—Å—Ç–æ—è–Ω–∏–µ Database ==="
ls -la backend/qwen.db* || echo "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

echo -e "\n=== –°–æ—Å—Ç–æ—è–Ω–∏–µ ComfyUI ==="
curl -s http://localhost:8188/system_stats || echo "ComfyUI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

echo -e "\n=== –ü—Ä–æ—Ü–µ—Å—Å—ã Python ==="
ps aux | grep -E "(run\.py|worker|bot)" | grep -v grep

echo -e "\n=== –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ ==="
netstat -tulpn | grep -E ":(8000|8188|443)"

echo -e "\n=== GPU —Å—Ç–∞—Ç—É—Å ==="
nvidia-smi || echo "NVIDIA –¥—Ä–∞–π–≤–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"

echo -e "\n=== –§–∞–π–ª—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ==="
ls -la /tmp/gpu.lock || echo "GPU –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints
```bash
#!/bin/bash
# test_api.sh

BASE_URL="http://localhost:8000"

echo "=== –¢–µ—Å—Ç API Endpoints ==="

echo "Health check:"
curl -s $BASE_URL/health

echo -e "\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:"
curl -s $BASE_URL/api/users/1

echo -e "\n\n–ë–∞–ª–∞–Ω—Å:"
curl -s $BASE_URL/api/balance/1

echo -e "\n\n–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏:"
curl -s $BASE_URL/api/presets

echo -e "\n\n–ü–ª–∞—Ç–µ–∂–∏:"
curl -s $BASE_URL/api/payments/user/1
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
top -p $(pgrep -f "python.*run.py")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
ps aux | grep -E "(run\.py|worker|bot)" | awk '{print $4, $11}'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU
nvidia-smi -l 1

# –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
df -h
du -sh backend/qwen.db*
```

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# Vacuum SQLite
sqlite3 backend/qwen.db "VACUUM;"

# –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü
sqlite3 backend/qwen.db ".schema"
sqlite3 backend/qwen.db "SELECT COUNT(*) FROM users;"
sqlite3 backend/qwen.db "SELECT COUNT(*) FROM jobs;"
sqlite3 backend/qwen.db "SELECT COUNT(*) FROM payments;"
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
grep -r "SECRET" backend/.env bot/.env worker/.env || echo "SECRET –Ω–µ –Ω–∞–π–¥–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
ls -la backend/.env bot/.env worker/.env

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
curl -s -X GET "https://api.telegram.org/bot<BOT_TOKEN>/getMe" || echo "–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω"
```

---

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- **–û–°**: Ubuntu 20.04+ LTS
- **CPU**: 4+ —è–¥–µ—Ä
- **RAM**: 8+ –ì–ë
- **–î–∏—Å–∫**: 50+ –ì–ë SSD
- **GPU**: NVIDIA RTX 3070+ —Å 8+ –ì–ë VRAM
- **–°–µ—Ç—å**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP, –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã 80, 443, 8000

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python 3.9
sudo apt install -y python3.9 python3.9-pip python3.9-venv python3.9-dev

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
sudo apt install -y build-essential libpq-dev postgresql-client nginx

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NVIDIA –¥—Ä–∞–π–≤–µ—Ä–æ–≤ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GPU)
sudo apt install -y nvidia-driver-470
sudo reboot

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
```nginx
# /etc/nginx/sites-available/qweneditbot
server {
    listen 80;
    server_name yourdomain.com;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;
    
    # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    
    # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    ssl_prefer_server_ciphers off;
    
    # Backend API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    location /static/ {
        alias /var/www/qweneditbot/static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Webhook –¥–ª—è YuKassa
    location /api/webhooks/yukassa {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –î–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –Ω—É–∂–Ω—ã –æ—Å–æ–±—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        proxy_read_timeout 10s;
        proxy_connect_timeout 10s;
    }
    
    # –õ–æ–≥–∏
    access_log /var/log/nginx/qweneditbot.access.log;
    error_log /var/log/nginx/qweneditbot.error.log;
}
```

#### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏
sudo ln -s /etc/nginx/sites-available/qweneditbot /etc/nginx/sites-enabled/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx
sudo systemctl reload nginx
```

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å Let's Encrypt

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
```bash
sudo apt install -y certbot python3-certbot-nginx
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
sudo certbot --nginx -d yourdomain.com
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
sudo crontab -e
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
0 12 * * * /usr/bin/certbot renew --quiet
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### –°–æ–∑–¥–∞–Ω–∏–µ systemd —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Backend
```ini
# /etc/systemd/system/qweneditbot-backend.service
[Unit]
Description=QwenEditBot Backend API
After=network.target

[Service]
Type=simple
User=qweneditbot
WorkingDirectory=/home/qweneditbot/QwenEditBot/backend
Environment=PATH=/home/qweneditbot/QwenEditBot/backend/venv/bin
ExecStart=/home/qweneditbot/QwenEditBot/backend/venv/bin/python run.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### –°–æ–∑–¥–∞–Ω–∏–µ systemd —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è Worker
```ini
# /etc/systemd/system/qweneditbot-worker.service
[Unit]
Description=QwenEditBot Worker
After=network.target qweneditbot-backend.service

[Service]
Type=simple
User=qweneditbot
WorkingDirectory=/home/qweneditbot/QwenEditBot/worker
Environment=PATH=/home/qweneditbot/QwenEditBot/worker/venv/bin
ExecStart=/home/qweneditbot/QwenEditBot/worker/venv/bin/python run.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo useradd -m -s /bin/bash qweneditbot
sudo usermod -aG sudo qweneditbot

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
sudo -u qweneditbot git clone <repository-url> /home/qweneditbot/QwenEditBot

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
sudo -u qweneditbot python3.9 -m venv /home/qweneditbot/QwenEditBot/backend/venv
sudo -u qweneditbot python3.9 -m venv /home/qweneditbot/QwenEditBot/worker/venv
sudo -u qweneditbot python3.9 -m venv /home/qweneditbot/QwenEditBot/bot/venv

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
sudo -u qweneditbot /home/qweneditbot/QwenEditBot/backend/venv/bin/pip install -r /home/qweneditbot/QwenEditBot/backend/requirements.txt
sudo -u qweneditbot /home/qweneditbot/QwenEditBot/worker/venv/bin/pip install -r /home/qweneditbot/QwenEditBot/worker/requirements.txt
sudo -u qweneditbot /home/qweneditbot/QwenEditBot/bot/venv/bin/pip install -r /home/qweneditbot/QwenEditBot/bot/requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
sudo chown -R qweneditbot:qweneditbot /home/qweneditbot/QwenEditBot
sudo chmod +x /home/qweneditbot/QwenEditBot/backend/run.py
sudo chmod +x /home/qweneditbot/QwenEditBot/worker/run.py
sudo chmod +x /home/qweneditbot/QwenEditBot/bot/run.py
```

#### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ systemd
sudo systemctl daemon-reload

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
sudo systemctl enable qweneditbot-backend
sudo systemctl enable qweneditbot-worker

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl start qweneditbot-backend
sudo systemctl start qweneditbot-worker

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status qweneditbot-backend
sudo systemctl status qweneditbot-worker
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
```bash
# /etc/logrotate.d/qweneditbot
/home/qweneditbot/QwenEditBot/*/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 qweneditbot qweneditbot
    postrotate
        systemctl reload qweneditbot-backend qweneditbot-worker
    endscript
}
```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –ø–æ–º–æ—â—å—é htop
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ htop
sudo apt install -y htop

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
cat > /home/qweneditbot/monitor.sh << 'EOF'
#!/bin/bash
echo "=== QwenEditBot Status ==="
echo "Backend: $(systemctl is-active qweneditbot-backend)"
echo "Worker: $(systemctl is-active qweneditbot-worker)"
echo "Nginx: $(systemctl is-active nginx)"
echo ""
echo "=== Resource Usage ==="
echo "CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
echo "Memory: $(free | grep Mem | awk '{printf("%.1f%%", $3/$2 * 100.0)}')"
echo "Disk: $(df -h / | awk 'NR==2{printf "%s", $5}')"
echo ""
echo "=== Recent Errors ==="
tail -n 10 /home/qweneditbot/QwenEditBot/backend/logs/error.log
tail -n 10 /home/qweneditbot/QwenEditBot/worker/logs/worker.log
EOF

chmod +x /home/qweneditbot/monitor.sh
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –±—ç–∫–∞–ø–∞
cat > /home/qweneditbot/backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/home/qweneditbot/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
cp /home/qweneditbot/QwenEditBot/backend/qwen.db $BACKUP_DIR/qwen_$DATE.db

# –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
tar -czf $BACKUP_DIR/config_$DATE.tar.gz /home/qweneditbot/QwenEditBot/backend/.env /home/qweneditbot/QwenEditBot/worker/.env /home/qweneditbot/QwenEditBot/bot/.env

# –ë—ç–∫–∞–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
find /home/qweneditbot/QwenEditBot/worker/results -name "*.jpg" -mtime -7 -exec cp {} $BACKUP_DIR/results_$DATE/ \;

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
find $BACKUP_DIR -name "*.db" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete
find $BACKUP_DIR -name "*.jpg" -mtime +7 -delete

echo "Backup completed: $DATE"
EOF

chmod +x /home/qweneditbot/backup.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ crontab (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00)
sudo -u qweneditbot crontab -e
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
0 2 * * * /home/qweneditbot/backup.sh >> /home/qweneditbot/backup.log 2>&1
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### Dockerfile –¥–ª—è Backend
```dockerfile
# backend/Dockerfile
FROM python:3.9-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    build-essential \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
COPY . .

EXPOSE 8000

CMD ["python", "run.py"]
```

#### Docker Compose
```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=sqlite:///./qwen.db
      - COMFYUI_URL=http://comfyui:8188
    volumes:
      - ./backend:/app
      - /path/to/ComfyUI/input:/comfyui/input
    depends_on:
      - comfyui

  worker:
    build: ./worker
    environment:
      - BACKEND_API_URL=http://backend:8000
      - COMFYUI_URL=http://comfyui:8188
    volumes:
      - ./worker:/app
      - /path/to/ComfyUI/input:/comfyui/input
      - /path/to/ComfyUI/output:/comfyui/output
    depends_on:
      - backend
      - comfyui

  comfyui:
    image: comfyanonymous/comfyui:latest
    ports:
      - "8188:8188"
    volumes:
      - /path/to/ComfyUI:/app
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - /etc/letsencrypt:/etc/letsencrypt:ro
    depends_on:
      - backend
    restart: unless-stopped
```

---

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ API
```python
# POST /api/presets
{
  "name": "–°—Ç–∏–ª—å —Ä–µ–Ω–µ—Å—Å–∞–Ω—Å–∞",
  "description": "–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ç–æ –≤ –∫–∞—Ä—Ç–∏–Ω—É —ç–ø–æ—Ö–∏ –†–µ–Ω–µ—Å—Å–∞–Ω—Å–∞",
  "category": "Styles",
  "prompt": "renaissance style, classical painting, renaissance art, masterpiece"
}

# –û—Ç–≤–µ—Ç:
{
  "id": 5,
  "name": "–°—Ç–∏–ª—å —Ä–µ–Ω–µ—Å—Å–∞–Ω—Å–∞",
  "description": "–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ç–æ –≤ –∫–∞—Ä—Ç–∏–Ω—É —ç–ø–æ—Ö–∏ –†–µ–Ω–µ—Å—Å–∞–Ω—Å–∞",
  "category": "Styles",
  "prompt": "renaissance style, classical painting, renaissance art, masterpiece",
  "is_active": true,
  "created_at": "2024-01-01T00:00:00"
}
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ –∫–æ–¥
```python
# backend/scripts/create_presets.py
from app.database import SessionLocal
from app.models import Preset

def create_preset(name: str, description: str, category: str, prompt: str):
    db = SessionLocal()
    
    preset = Preset(
        name=name,
        description=description,
        category=category,
        prompt=prompt,
        is_active=True
    )
    
    db.add(preset)
    db.commit()
    db.refresh(preset)
    
    print(f"–°–æ–∑–¥–∞–Ω–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞: {preset.name} (ID: {preset.id})")
    db.close()

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
presets = [
    {
        "name": "–°—Ç–∏–ª—å –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º–∞",
        "description": "–ò–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏—Å—Ç—Å–∫–∏–π —Å—Ç–∏–ª—å —Å –º—è–≥–∫–∏–º–∏ –º–∞–∑–∫–∞–º–∏",
        "category": "Styles",
        "prompt": "impressionist style, soft brush strokes, impressionism, monet style"
    },
    {
        "name": "–ó–æ–ª–æ—Ç–æ–π —á–∞—Å",
        "description": "–¢–µ–ø–ª–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –∑–∞–∫–∞—Ç–∞/—Ä–∞—Å—Å–≤–µ—Ç–∞",
        "category": "Lighting",
        "prompt": "golden hour lighting, warm sunset, cinematic lighting, beautiful glow"
    },
    {
        "name": "–í–∏–Ω—Ç–∞–∂–Ω–∞—è —Ä–∞–º–∫–∞",
        "description": "–î–æ–±–∞–≤–ª—è–µ—Ç –≤–∏–Ω—Ç–∞–∂–Ω—É—é —Ä–∞–º–∫—É –∫ —Ñ–æ—Ç–æ",
        "category": "Design",
        "prompt": "vintage frame, sepia tone, old photo style, antique border"
    }
]

for preset_data in presets:
    create_preset(**preset_data)
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
```python
# backend/app/models.py
class Preset(Base):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    category = Column(String(50), index=True)  # Styles, Lighting, Design, NEW_CATEGORY
    
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ –±–æ—Ç–µ
# bot/keyboards.py
PRESET_CATEGORIES_KEYBOARD = InlineKeyboardMarkup(
    inline_keyboard=[
        [InlineKeyboardButton(text="üß© –°—Ç–∏–ª–∏", callback_data="category_styles")],
        [InlineKeyboardButton(text="üí° –û—Å–≤–µ—â–µ–Ω–∏–µ", callback_data="category_lighting")],
        [InlineKeyboardButton(text="üñº –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ", callback_data="category_design")],
        [InlineKeyboardButton(text="üé≠ –ê—Ä—Ç", callback_data="category_art")],  # –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_menu")]
    ]
)
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
```python
# bot/handlers/presets.py
@router.callback_query(F.data == "category_art")
async def process_art_category(callback: CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ Art"""
    await callback.message.edit_text(
        "üé≠ –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –∞—Ä—Ç:",
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="–°—Ç–∏–ª—å –í–∞–Ω –ì–æ–≥–∞", callback_data="preset_11")],
            [InlineKeyboardButton(text="–°—Ç–∏–ª—å –ú–æ–Ω–µ", callback_data="preset_12")],
            [InlineKeyboardButton(text="–°—Ç–∏–ª—å –ü–∏–∫–∞—Å—Å–æ", callback_data="preset_13")],
            [InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_categories")]
        ])
    )
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Stripe
```python
# backend/app/services/stripe_service.py
import stripe
from app.config import config

class StripeService:
    def __init__(self):
        stripe.api_key = config.STRIPE_API_KEY
    
    async def create_payment_intent(self, amount_rubles: int, user_id: int):
        """–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ Stripe"""
        payment_intent = stripe.PaymentIntent.create(
            amount=amount_rubles * 100,  # –í –∫–æ–ø–µ–π–∫–∞—Ö
            currency='rub',
            metadata={
                'user_id': user_id,
                'service': 'qweneditbot'
            }
        )
        
        return {
            'client_secret': payment_intent.client_secret,
            'payment_id': payment_intent.id
        }
    
    async def handle_webhook(self, payload: str, signature: str):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ Stripe webhook"""
        try:
            event = stripe.Webhook.construct_event(
                payload, signature, config.STRIPE_WEBHOOK_SECRET
            )
            
            if event['type'] == 'payment_intent.succeeded':
                payment_intent = event['data']['object']
                await self.process_successful_payment(payment_intent)
                
        except ValueError as e:
            raise Exception(f"Invalid payload: {e}")
        except stripe.error.SignatureVerificationError as e:
            raise Exception(f"Invalid signature: {e}")
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
```python
# backend/app/api/admin.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from app.database import get_db
from app.models import User, Job, Payment
from app.schemas.admin import SystemStats

router = APIRouter(prefix="/api/admin", tags=["admin"])

@router.get("/stats", response_model=SystemStats)
async def get_system_stats(db: Session = Depends(get_db)):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã"""
    
    total_users = db.query(User).count()
    total_jobs = db.query(Job).count()
    completed_jobs = db.query(Job).filter(Job.status == "completed").count()
    failed_jobs = db.query(Job).filter(Job.status == "failed").count()
    
    total_payments = db.query(Payment).count()
    successful_payments = db.query(Payment).filter(Payment.status == "succeeded").count()
    total_revenue = db.query(Payment).filter(
        Payment.status == "succeeded"
    ).with_entities(Payment.amount_rubles).all()
    
    revenue = sum([p[0] for p in total_revenue])
    
    return SystemStats(
        total_users=total_users,
        total_jobs=total_jobs,
        completed_jobs=completed_jobs,
        failed_jobs=failed_jobs,
        success_rate=completed_jobs / total_jobs if total_jobs > 0 else 0,
        total_payments=total_payments,
        successful_payments=successful_payments,
        total_revenue=revenue
    )
```

#### –°—Ö–µ–º–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```python
# backend/app/schemas/admin.py
from pydantic import BaseModel
from typing import Optional

class SystemStats(BaseModel):
    total_users: int
    total_jobs: int
    completed_jobs: int
    failed_jobs: int
    success_rate: float
    total_payments: int
    successful_payments: int
    total_revenue: float
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–¥–∞—á

#### –í–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å Job
class Job(Base):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    job_type = Column(String(20), default="image", index=True)  # image, video
    input_path = Column(String(500))  # –ü—É—Ç—å –∫ –≤—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É
    output_path = Column(String(500))  # –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É
```

#### –°–æ–∑–¥–∞–Ω–∏–µ VideoProcessor
```python
# worker/processors/video_editor.py
class VideoProcessor:
    def __init__(self):
        self.supported_formats = ['.mp4', '.avi', '.mov', '.mkv']
    
    async def process_video(self, job: Job) -> str:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ"""
        try:
            # –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ ComfyUI
            video_id = await self.comfyui_client.upload_video(job.input_path)
            
            # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
            job_id = await self.comfyui_client.submit_video_job(
                video_id, job.preset.prompt if job.preset else job.custom_prompt
            )
            
            # –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            result_path = await self.comfyui_client.wait_for_video_result(job_id)
            
            return result_path
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {job.id}: {e}")
            raise
```

### –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
```python
# backend/app/plugins/base.py
from abc import ABC, abstractmethod
from typing import Dict, Any

class BasePlugin(ABC):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤"""
    
    @property
    @abstractmethod
    def name(self) -> str:
        """–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞"""
        pass
    
    @property
    @abstractmethod
    def version(self) -> str:
        """–í–µ—Ä—Å–∏—è –ø–ª–∞–≥–∏–Ω–∞"""
        pass
    
    @abstractmethod
    async def initialize(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞"""
        pass
    
    @abstractmethod
    async def process_image(self, image_path: str, parameters: Dict[str, Any]) -> str:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
        pass
    
    @abstractmethod
    async def cleanup(self) -> None:
        """–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤"""
        pass
```

#### –ü—Ä–∏–º–µ—Ä –ø–ª–∞–≥–∏–Ω–∞
```python
# backend/app/plugins/background_remover.py
from .base import BasePlugin
import cv2
import numpy as np

class BackgroundRemoverPlugin(BasePlugin):
    """–ü–ª–∞–≥–∏–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞"""
    
    @property
    def name(self) -> str:
        return "Background Remover"
    
    @property
    def version(self) -> str:
        return "1.0.0"
    
    async def initialize(self) -> None:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞"""
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, U¬≤-Net)
        pass
    
    async def process_image(self, image_path: str, parameters: Dict[str, Any]) -> str:
        """–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞"""
        # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        image = cv2.imread(image_path)
        
        # –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä)
        # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
        result = await self.remove_background(image)
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        result_path = image_path.replace('.jpg', '_no_bg.png')
        cv2.imwrite(result_path, result)
        
        return result_path
    
    async def cleanup(self) -> None:
        """–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤"""
        pass
    
    async def remove_background(self, image) -> np.ndarray:
        # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        return image  # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ —Ñ–æ–Ω–∞
```

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤
```python
# backend/app/plugins/manager.py
from typing import List, Type
from .base import BasePlugin
from .background_remover import BackgroundRemoverPlugin

class PluginManager:
    def __init__(self):
        self.plugins: List[BasePlugin] = []
    
    def register_plugin(self, plugin_class: Type[BasePlugin]):
        """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞"""
        plugin = plugin_class()
        self.plugins.append(plugin)
        print(f"–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ø–ª–∞–≥–∏–Ω: {plugin.name} v{plugin.version}")
    
    async def initialize_plugins(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–ª–∞–≥–∏–Ω–æ–≤"""
        for plugin in self.plugins:
            await plugin.initialize()
    
    async def process_with_plugin(self, plugin_name: str, image_path: str, parameters: Dict[str, Any]) -> str:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–º–æ—â—å—é —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞"""
        for plugin in self.plugins:
            if plugin.name == plugin_name:
                return await plugin.process_image(image_path, parameters)
        
        raise ValueError(f"–ü–ª–∞–≥–∏–Ω {plugin_name} –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    async def cleanup_plugins(self):
        """–û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–ª–∞–≥–∏–Ω–æ–≤"""
        for plugin in self.plugins:
            await plugin.cleanup()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
plugin_manager = PluginManager()
plugin_manager.register_plugin(BackgroundRemoverPlugin)
```

### API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### Webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```python
# backend/app/api/webhooks.py
from fastapi import APIRouter, Request
from typing import Dict, Any

router = APIRouter(prefix="/api/webhooks", tags=["webhooks"])

@router.post("/notify")
async def send_notification(data: Dict[str, Any]):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ"""
    try:
        webhook_url = data.get('url')
        payload = data.get('payload')
        
        if not webhook_url or not payload:
            raise HTTPException(status_code=400, detail="URL –∏ payload –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã")
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–∞
        async with httpx.AsyncClient() as client:
            response = await client.post(webhook_url, json=payload)
        
        return {"status": "sent", "response_code": response.status_code}
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

#### GraphQL API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```python
# backend/app/graphql/schema.py
import strawberry
from typing import List, Optional

@strawberry.type
class User:
    id: int
    telegram_id: int
    username: Optional[str]
    balance: int
    created_at: str

@strawberry.type
class Preset:
    id: int
    name: str
    description: str
    category: str
    prompt: str

@strawberry.type
class Job:
    id: int
    status: str
    created_at: str

@strawberry.type
class Query:
    @strawberry.field
    def user(self, user_id: int) -> Optional[User]:
        # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        pass
    
    @strawberry.field
    def presets(self, category: Optional[str] = None) -> List[Preset]:
        # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–æ–∫
        pass
    
    @strawberry.field
    def jobs(self, user_id: int, limit: int = 10) -> List[Job]:
        # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞—á
        pass

schema = strawberry.Schema(query=Query)
```

---

## –õ–∏—Ü–µ–Ω–∑–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º. –≤ —Ñ–∞–π–ª–µ LICENSE.

```
MIT License

Copyright (c) 2024 QwenEditBot

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞

#### –°–æ–æ–±—â–µ—Å—Ç–≤–æ
- **GitHub Issues**: [–°—Å—ã–ª–∫–∞ –Ω–∞ Issues](https://github.com/your-repo/issues)
- **Discussions**: [–°—Å—ã–ª–∫–∞ –Ω–∞ Discussions](https://github.com/your-repo/discussions)
- **Wiki**: [–°—Å—ã–ª–∫–∞ –Ω–∞ Wiki](https://github.com/your-repo/wiki)

#### –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ü–∏—è

–ú—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞! –í–æ—Ç –∫–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–º–æ—á—å:

1. **Fork** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ **feature branch** (`git checkout -b feature/AmazingFeature`)
3. **Commit** –≤–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add some AmazingFeature'`)
4. **Push** –≤ branch (`git push origin feature/AmazingFeature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ **Pull Request**

#### –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ü–∏–∏

```markdown
## –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Black –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Python –∫–æ–¥–∞
- –î–æ–±–∞–≤–ª—è–π—Ç–µ type hints –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
- –ü–∏—à–∏—Ç–µ docstrings –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## Commit —Å–æ–æ–±—â–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ conventional commits
- –§–æ—Ä–º–∞—Ç: `type(scope): description`
- –ü—Ä–∏–º–µ—Ä—ã:
  - `feat(api): add user statistics endpoint`
  - `fix(bot): resolve image upload timeout`
  - `docs(readme): update installation guide`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ PR: `pytest`
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–º–ø–æ—Ä—Ç—ã: `python -m py_compile *.py`
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ API: `python test_api.py`
```

### –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã (FAQ)

#### –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

**–í: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –±–µ–∑ GPU?**
–û: –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –¥–∞, –Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ–π. –†–µ–∫–¥—É–µ—Ç—Å—è NVIDIA GPU —Å CUDA.

**–í: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤–∏–¥–µ–æ?**
–û: –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–æ –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è.

**–í: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏?**
–û: –î–∞, –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `EDIT_COST` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–í: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏?**
–û: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ API –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã

**–í: –ü–æ—á–µ–º—É –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞?**
–û: –û–±—ã—á–Ω–æ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend.

**–í: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã?**
–û: –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.py` —Ñ–∞–π–ª–∞—Ö –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

**–í: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL –≤–º–µ—Å—Ç–æ SQLite?**
–û: –î–∞, –∏–∑–º–µ–Ω–∏—Ç–µ `DATABASE_URL` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ backend.

### –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫**: [–í–∞—à–µ –∏–º—è](mailto:your.email@example.com)
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: support@qweneditbot.com
- **–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã**: business@qweneditbot.com

### –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **ComfyUI Team** - –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –ò–ò –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **FastAPI Team** - –∑–∞ –±—ã—Å—Ç—Ä—ã–π –∏ —É–¥–æ–±–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **aiogram Team** - –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è Telegram –±–æ—Ç–æ–≤
- **YuKassa** - –∑–∞ –Ω–∞–¥–µ–∂–Ω—É—é –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- **Open Source Community** - –∑–∞ –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

QwenEditBot –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –ò–ò, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤ —Å–µ–±–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:

- **FastAPI** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ backend
- **Telegram Bot** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **ComfyUI** –¥–ª—è –º–æ—â–Ω–æ–π –ò–ò –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **YuKassa** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **SQLite** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –ø–æ–¥ –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã  
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ  

### –ì–æ—Ç–æ–≤—ã–µ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

üéØ **Backend API** - –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π REST API  
ü§ñ **Telegram Bot** - –≥–æ—Ç–æ–≤—ã–π –∫ —Ä–∞–±–æ—Ç–µ –±–æ—Ç  
‚ö° **Worker System** - –Ω–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏  
üí∞ **–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YuKassa  
üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞  

–ú—ã –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å QwenEditBot!

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: –Ø–Ω–≤–∞—Ä—å 2024*  
*–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: 1.0*  
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 12.01.2024*
