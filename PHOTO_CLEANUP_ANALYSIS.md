# üì∏ –ê–Ω–∞–ª–∏–∑ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ Telegram. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–µ:

## –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### 1. –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (—É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- **`bot/handlers/image_upload.py:183`** - —É–¥–∞–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ backend
- **`bot/handlers/custom_prompt.py:155`** - —É–¥–∞–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- **`bot/handlers/menu.py:2734-2735`** - —É–¥–∞–ª—è—é—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ—á–Ω–æ–π

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —É–¥–∞–ª—è—Ç—å—Å—è.

### 2. –í—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ (—É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏) ‚ö†Ô∏è

**–§–∞–π–ª:** `worker/processors/image_editor.py:54-63`

```python
# Clean up input files only after a successful run.
# This is important because the worker can re-queue jobs for retry on failures.
for path in cleanup_paths:
    try:
        path.unlink()
        logger.debug(f"Cleaned up input file: {path}")
    except FileNotFoundError:
        pass
    except Exception as e:
        logger.warning(f"Failed to clean up input file {path}: {str(e)}")
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ `COMFY_INPUT_DIR`.

## –ì–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ñ–æ—Ç–æ

1. **Backend (`backend/app/api/jobs.py:88-89`)**:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `settings.COMFY_INPUT_DIR` (–æ–±—ã—á–Ω–æ `C:/ComfyUI/ComfyUI/input`)
   - –ò–º—è —Ñ–∞–π–ª–∞: `input_{uuid}.{ext}`

2. **Backend (`backend/app/api/telegram.py:135-136`)**:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `settings.COMFY_INPUT_DIR`
   - –ò–º—è —Ñ–∞–π–ª–∞: `input_{task_id}.jpg`

## –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —É–¥–∞–ª–µ–Ω–∏—è

### ‚úÖ –ü–ª—é—Å—ã:
- –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

### ‚ùå –ú–∏–Ω—É—Å—ã:
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–æ—Ç–æ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ñ–æ—Ç–æ
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ
- –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω - —Ñ–æ—Ç–æ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–ª—é—á–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ç–æ
–£–±—Ä–∞—Ç—å –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫ –æ—á–∏—Å—Ç–∫–∏ –≤ `image_editor.py`.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
–£–¥–∞–ª—è—Ç—å –≤—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è
–£–¥–∞–ª—è—Ç—å —Ñ–æ—Ç–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞).

### –í–∞—Ä–∏–∞–Ω—Ç 4: –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–ø–∏–∏
–°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–ø–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ç–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º.

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –í—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–î–µ–π—Å—Ç–≤–∏–µ:** –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ –∏–ª–∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
