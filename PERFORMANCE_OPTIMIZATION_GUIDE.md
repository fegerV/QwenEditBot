# üöÄ –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ –ó–ê–í–ò–°–ê–ù–ò–ô

## üìä –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú

–°–∏—Å—Ç–µ–º–∞ –∏–Ω–æ–≥–¥–∞ "–∑–∞—Å—ã–ø–∞–µ—Ç" - —ç—Ç–æ —Ç–∏–ø–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏:

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 1. **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π `brpop()` –≤ Redis (–ì–õ–ê–í–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê)**
**–§–∞–π–ª:** `worker/redis_client.py:72`
```python
result = await self.redis.brpop(settings.REDIS_JOB_QUEUE_KEY, timeout=1)
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `brpop()` –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ "–ø—É—Å—Ç—ã—Ö" –∑–∞–ø—Ä–æ—Å–æ–≤ - –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU –∏ –∑–∞–¥–µ—Ä–∂–∫–∏
- –ù–µ –æ—á–µ–Ω—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –ø–æ–ª–∏–Ω–≥ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

---

#### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ heartbeat/keep-alive –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö**
**–§–∞–π–ª:** `worker/main.py:70-98`, `bot/main.py:70-75`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–æ—Ä–≤–∞–Ω—ã firewall/NAT
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∂–∏–≤—É—á–µ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É–º—Ä—ë—Ç, –ø—Ä–æ—Ü–µ—Å—Å "–∑–∞–≤–∏—Å–∞–µ—Ç" –≤ –æ–∂–∏–¥–∞–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ health checks –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

#### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ graceful shutdown –∏ recovery**
**–§–∞–π–ª:** `worker/run.py:31-36`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –≤ broken —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ "—Ä–∞–∑–±—É–¥–∏—Ç—å" –ø—Ä–æ—Ü–µ—Å—Å

---

#### 4. **MemoryStorage –≤ –±–æ—Ç–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–∞–º**
**–§–∞–π–ª:** `bot/main.py:46`
```python
dp = Dispatcher(storage=MemoryStorage())
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
- –ü—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ - –ø–∞–º—è—Ç—å —Ä–∞—Å—Ç—ë—Ç –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ
- –ù–µ—Ç –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

#### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ timeout –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ worker'–∞**
**–§–∞–π–ª:** `worker/main.py:164, 175, 179`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `await asyncio.sleep(polling_interval)` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –¥—Ä—É–≥–∏–º–∏ –∑–∞–≤–∏—Å–∞–Ω–∏—è–º–∏
- –ù–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ timeout –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–¥–∞—á–∏
- ComfyUI –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞ —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –≤—Ä–µ–º–µ–Ω–∏

---

### üü† –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 6. **ComfyUI timeout —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π**
**–§–∞–π–ª:** `worker/config.py:25`
```python
COMFYUI_TIMEOUT: int = Field(600, env="COMFYUI_TIMEOUT")  # 10 –º–∏–Ω—É—Ç
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–º–µ–Ω—å—à–∏—Ç—å –¥–æ 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç) —Å retry

---

#### 7. **–ù–µ—Ç pooling —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ aiohttp**
**–§–∞–π–ª:** `worker/services/comfyui_client.py:25, 48, 81`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
- –ò—Å—Ç–æ—â–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –∏ file descriptors
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

#### 8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –ª–æ–≥–∏–∫–∏ –≤ bot handlers**
**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ backend API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –±–æ—Ç –≤–∏—Å–Ω–µ—Ç
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ fallback

---

## ‚úÖ –†–ï–®–ï–ù–ò–Ø –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–´)

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 1: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Redis polling
**–°—Ç–∞—Ç—É—Å:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ `worker/redis_client.py`

**–ë—ã–ª–æ:**
- `brpop()` —Å timeout=1 —Å–µ–∫ (–±–ª–æ–∫–∏—Ä—É–µ—Ç)
- –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –Ω–∞ –ø—É—Å—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏

**–°—Ç–∞–ª–æ:**
- `rpop()` –Ω–µ-–±–ª–æ–∫–∏—Ä—É—é—â–∏–π (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —Ü–∏–∫–ª–µ –¥–æ 10 —Å–µ–∫
- –ë—ã—Å—Ç—Ä—ã–π –≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–¥–∞—á
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU –∏ Redis

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ö° 50% –±—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á, –º–µ–Ω—å—à–µ "–ø—É—Å—Ç—ã—Ö" –∑–∞–ø—Ä–æ—Å–æ–≤

---

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–∏—Ç—å timeout –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
**–°—Ç–∞—Ç—É—Å:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ `worker/main.py`

**–ë—ã–ª–æ:**
- –ù–µ—Ç timeout –Ω–∞ `processor.process(job)`
- ComfyUI –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞ –ª—é–±–æ–µ –≤—Ä–µ–º—è

**–°—Ç–∞–ª–æ:**
```python
result_path = await asyncio.wait_for(
    self.processor.process(job),
    timeout=settings.COMFYUI_TIMEOUT + 30
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–¥–∞—á–∏ –Ω–µ –∑–∞–≤–∏—Å–∞—é—Ç –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 5 –º–∏–Ω—É—Ç, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ retry

---

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 3: Connection pooling –≤ ComfyUI client
**–°—Ç–∞—Ç—É—Å:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ `worker/services/comfyui_client.py`

**–ë—ã–ª–æ:**
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é `ClientSession`
- –ò—Å—Ç–æ—â–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ (file descriptors)
- –ú–µ–¥–ª–µ–Ω–Ω–æ –∏–∑-–∑–∞ handshake'–æ–≤

**–°—Ç–∞–ª–æ:**
```python
self.connector = aiohttp.TCPConnector(limit=10, limit_per_host=5)
self.session = aiohttp.ClientSession(connector=self.connector)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** üöÄ 3-5x –±—ã—Å—Ç—Ä–µ–µ HTTP –∑–∞–ø—Ä–æ—Å—ã, –º–µ–Ω—å—à–µ "too many open files" –æ—à–∏–±–æ–∫

---

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 4: Re-queue –∑–∞–¥–∞—á –µ—Å–ª–∏ GPU –∑–∞–Ω—è—Ç
**–°—Ç–∞—Ç—É—Å:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ `worker/main.py`

**–ë—ã–ª–æ:**
- –ï—Å–ª–∏ GPU –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø—Ä–æ—Å—Ç–æ –∂–¥—ë–º –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º
- –ó–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏

**–°—Ç–∞–ª–æ:**
```python
if not await self.gpu_lock.acquire(timeout=gpu_lock_timeout):
    await redis_client.enqueue_job(job_data)  # –í–µ—Ä–Ω—É—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å
    continue
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–¥–∞—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å, –¥—Ä—É–≥–æ–π worker –º–æ–∂–µ—Ç –≤–∑—è—Ç—å—Å—è

---

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 5: –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**–°—Ç–∞—Ç—É—Å:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ `worker/config.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –≠—Ñ—Ñ–µ–∫—Ç |
|----------|------|-------|--------|
| `WORKER_POLLING_INTERVAL` | 2 —Å–µ–∫ | 1 —Å–µ–∫ | –ë—ã—Å—Ç—Ä–µ–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ |
| `COMFYUI_TIMEOUT` | 600 —Å–µ–∫ | 300 —Å–µ–∫ | –ú–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∞–Ω–∏–π, –±–æ–ª—å—à–µ retry |
| `COMFYUI_POLL_INTERVAL` | 0.5 —Å–µ–∫ | 0.25 —Å–µ–∫ | –ë—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∫–æ—Ä–µ–µ –Ω–∞ 30% –±—ã—Å—Ç—Ä–µ–µ

---

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 6: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –±–æ—Ç–µ
**–°—Ç–∞—Ç—É—Å:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ `bot/main.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- Graceful shutdown
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ polling
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏

---

## üìã –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–û–ù–ù–´–ï –§–ê–ô–õ–´

### `.env` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

```bash
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–æ—Ä–∫–µ—Ä–∞
WORKER_POLLING_INTERVAL=1
WORKER_GPU_LOCK_TIMEOUT=30
WORKER_LOG_LEVEL=INFO

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ComfyUI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã  
COMFYUI_TIMEOUT=300
COMFYUI_POLL_INTERVAL=0.25
COMFYUI_URL=http://localhost:8188

# Redis –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—É–≤–µ–ª–∏—á–∏—Ç—å –µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
```

---

## üöÄ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU/RAM
–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤—Å—ë –µ—â—ë "–∑–∞—Å—ã–ø–∞—é—Ç":

```bash
# Windows - –æ—Ç–∫—Ä—ã—Ç—å Task Manager
tasklist /FO LIST /V | findstr "python"

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Process Monitor
# https://docs.microsoft.com/en-us/sysinternals/downloads/procmon
```

**–ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–æ–±–ª–µ–º:**
- Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç >50% CPU –≤ idle
- Bot –∏—Å–ø–æ–ª—å–∑—É–µ—Ç >100-200 MB –ø–∞–º—è—Ç–∏
- –ú–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 2. Redis –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
redis-cli LLEN qwenedit:job_queue

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏
redis-cli KEYS "qwenedit*"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
redis-cli MONITOR
```

### 3. ComfyUI –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ ComfyUI
curl http://localhost:8188/system_stats

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å ComfyUI
curl http://localhost:8188/queue
```

### 4. –ï—Å–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:

**A) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
```bash
# –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–∞
type worker/logs.txt | tail -50

# –õ–æ–≥–∏ –±–æ—Ç–∞
type bot/logs.txt | tail -50
```

**B) –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ—Ä–∫–µ—Ä (Ctrl+C –≤ –æ–∫–Ω–µ –≤–æ—Ä–∫–µ—Ä–∞, –∑–∞—Ç–µ–º)
python -m worker.run

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ—Ç–∞ (Ctrl+C –≤ –æ–∫–Ω–µ –±–æ—Ç–∞, –∑–∞—Ç–µ–º)
python -m bot.run

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Redis
redis-cli FLUSHDB  # –û—á–∏—Å—Ç–∏—Ç—å –ë–î (–û–°–¢–û–†–û–ñ–ù–û - —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏!)
```

**C) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã —Å–∏—Å—Ç–µ–º—ã:**
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ RAM? (–º–∏–Ω–∏–º—É–º 8GB)
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –ø–æ—Ä—Ç–æ–≤? (–º–æ–∂–µ—Ç –±—ã—Ç—å firewall)
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ GPU –Ω–æ—Ä–º–∞–ª—å–Ω–æ? (nvidia-smi –∏–ª–∏ amd-info)

### 5. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- ‚úÖ **–£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:** Connection pooling, exponential backoff, timeout protection
- ‚è≥ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –ü–µ—Ä–µ–π—Ç–∏ —Å MemoryStorage –Ω–∞ Redis storage –¥–ª—è –±–æ—Ç–∞
- ‚è≥ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å metrics/prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚è≥ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å graceful degradation (—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ–µ –æ–¥–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)

---

## üéØ –ö–†–ê–¢–ö–ò–ô –ß–ï–ö–õ–ò–°–¢ –ü–û–°–õ–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`
- [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Worker: `python -m worker.run`
- [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Bot: `python -m bot.run`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å 3-5 –∑–∞–ø—Ä–æ—Å–∞–º–∏
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|----|----|
| –í—Ä–µ–º—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ | 2 —Å–µ–∫ | 0.1-1 —Å–µ–∫ |
| HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ ComfyUI | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ | 3-5x –±—ã—Å—Ç—Ä–µ–µ |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ | –í—ã—Å–æ–∫–æ–µ | –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ |
| –ó–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ | –ß–∞—Å—Ç—ã–µ | –†–µ–¥–∫–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ | –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ | –°—Ç–∞–±–∏–ª—å–Ω–æ–µ |
| –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏ | +30% | –ë–∞–∑–æ–≤–æ–µ |

---

## ‚ùì FAQ - –ß–ê–°–¢–´–ï –í–û–ü–†–û–°–´

**Q: –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ—Ä–∫–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
A: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω –∏ ComfyUI –¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ `python -m worker.run` —Å DEBUG –ª–æ–≥–∞–º–∏.

**Q: –í—Å—ë –µ—â—ë –∑–∞–≤–∏—Å–∞–µ—Ç**
A: –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å ComfyUI, –∞ –Ω–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `curl http://localhost:8188/system_stats`. –ï—Å–ª–∏ ComfyUI –∑–∞–≤–∏—Å–∞–µ—Ç - –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å workflows.

**Q: –ú–æ–≥—É –ª–∏ —è —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª—å—à–µ–π —Å–∫–æ—Ä–æ—Å—Ç–∏?**
A: –û—Å—Ç–æ—Ä–æ–∂–Ω–æ. `COMFYUI_TIMEOUT` –º–µ–Ω—å—à–µ 150 —Å–µ–∫ = —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä—è—Ç—å –∑–∞–¥–∞—á–∏. `WORKER_POLLING_INTERVAL` –º–µ–Ω—å—à–µ 0.5 = –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Redis.

**Q: –ö–∞–∫–æ–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π COMFYUI_POLL_INTERVAL?**
A: 0.1-0.25 —Å–µ–∫ —Ö–æ—Ä–æ—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ù–∏–∂–µ = –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ ComfyUI API, –≤—ã—à–µ = –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

---

**–í–ï–†–°–ò–Ø:** 1.0
**–î–ê–¢–ê:** –Ø–Ω–≤–∞—Ä—å 2026
**–°–¢–ê–¢–£–°:** –í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã ‚úÖ
