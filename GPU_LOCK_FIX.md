# üî¥ GPU LOCK ISSUE - –†–ï–®–ï–ù–ò–ï

## üêõ –ü–†–û–ë–õ–ï–ú–ê

Worker –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è —Å –æ—à–∏–±–∫–æ–π:
```
GPU lock timeout after 30 seconds
Failed to acquire GPU lock
```

–ü—Ä–∏—á–∏–Ω–∞: –§–∞–π–ª `.gpu_lock` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–ª—Å—è –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª GPU.

## üîç –ö–ê–ö –≠–¢–û –ü–†–û–ò–°–•–û–î–ò–õ–û

1. –§–∞–π–ª `.gpu_lock` —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏
2. –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–∏—Å–∞–ª–∞ –∏–ª–∏ –ø–∞–¥–∞–ª–∞, —Ñ–∞–π–ª –æ—Å—Ç–∞–≤–∞–ª—Å—è
3. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –º–æ–≥–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ GPU
4. Worker –∑–∞–≤–∏—Å–∞–ª –≤ —Ü–∏–∫–ª–µ retry

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –°–ø–æ—Å–æ–± 1: –†—É—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–í—Ä–µ–º–µ–Ω–Ω–æ–µ)
```bash
cd c:\QwenEditBot
del .gpu_lock
```

–§–∞–π–ª –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ.

### –°–ø–æ—Å–æ–± 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ)

–î–æ–±–∞–≤–∏—Ç—å –≤ `worker/run.py` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
```python
import os
from pathlib import Path

# Clean up stale GPU lock on startup
lock_file = Path(".gpu_lock")
if lock_file.exists():
    try:
        lock_file.unlink()
        logger.info("Cleaned up stale GPU lock file")
    except Exception as e:
        logger.warning(f"Failed to clean GPU lock: {e}")
```

## üìä –ö–¢–û –í–ò–ù–û–í–ê–¢?

–ú–µ—Ö–∞–Ω–∏–∑–º GPU lock (`worker/gpu/lock.py`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º:
- ‚úÖ –•–æ—Ä–æ—à–æ: –ü—Ä–æ—Å—Ç–æ–π, —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå –ü–ª–æ—Ö–æ: –ù–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–≤–∞—Ä–∏–π–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É `.gpu_lock` –ø—Ä–∏:
1. –ó–∞–ø—É—Å–∫–µ worker'–∞ (–µ—Å–ª–∏ —Ñ–∞–π–ª —Å—Ç–∞—Ä—à–µ 5 –º–∏–Ω—É—Ç)
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (ensure cleanup)
3. –ü—Ä–∏ graceful shutdown

## üìù –°–¢–ê–¢–£–°

**–ò–°–ü–†–ê–í–õ–ï–ù–û –í–†–£–ß–ù–£–Æ:**
- ‚úÖ –§–∞–π–ª `.gpu_lock` —É–¥–∞–ª—ë–Ω
- ‚úÖ Worker –≤–æ–∑–æ–±–Ω–æ–≤–∏–ª –æ–±—Ä–∞–±–æ—Ç–∫—É
- ‚úÖ Job 186 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

**–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø:**
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –≤ `worker/run.py`
- –£–ª—É—á—à–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º lock (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PID –≤ —Ñ–∞–π–ª–µ)
