# üìä –ê–ù–ê–õ–ò–ó –õ–û–ì–û–í WATCHDOG

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 25 —è–Ω–≤–∞—Ä—è 2026, 00:40+

---

## ‚úÖ –°–¢–ê–¢–£–° –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

### 1. ComfyUI Watchdog
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 5 —Å–µ–∫—É–Ω–¥ (—É–ª—É—á—à–µ–Ω–æ —Å 10 —Å–µ–∫)
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫:** 2026-01-25 00:33:41
- **–õ–æ–≥–∏:** `logs/comfyui/watchdog.log`

**–ù–∞–±–ª—é–¥–µ–Ω–∏—è:**
- Watchdog —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è —Å –Ω–æ–≤—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 5 —Å–µ–∫—É–Ω–¥
- –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã health check (ComfyUI –∑–∞—Å—ã–ø–∞–µ—Ç)
- Watchdog –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–±—É–¥–∏—Ç—å ComfyUI –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º
- **–ü—Ä–æ–±–ª–µ–º–∞:** Proactive wakeup –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `logger.debug` - –Ω–µ –≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

---

### 2. ComfyUI Window Waker
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ë—ã–ª–∞ –æ—à–∏–±–∫–∞, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ —Ç–∏–ø–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ `EnumWindows`
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø `ctypes.wintypes.HWND` –∏ `ctypes.wintypes.LPARAM`
- **–¢–µ—Å—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç –æ–∫–Ω–æ ComfyUI (HWND: 10486688)
- **–õ–æ–≥–∏:** `logs/comfyui/waker.log`

**–û—à–∏–±–∫–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞):**
```
ctypes.ArgumentError: argument 2: TypeError: Don't know how to convert parameter 2
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –¥–ª—è callback —Ñ—É–Ω–∫—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `found_windows` –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∏ —á–µ—Ä–µ–∑ LPARAM
- –¢–∏–ø callback: `ctypes.WINFUNCTYPE(ctypes.c_bool, ctypes.wintypes.HWND, ctypes.wintypes.LPARAM)`

---

### 3. Worker Proactive Wakeup
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω
- **–õ–æ–≥–∏–∫–∞:** –ö–∞–∂–¥—ã–µ 40 –ø–æ–ø—ã—Ç–æ–∫ (10 —Å–µ–∫—É–Ω–¥) –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- **–õ–æ–≥–∏:** `logs/worker/runtime.log`
- **–ù–∞–±–ª—é–¥–µ–Ω–∏—è:** –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, –ø–æ—ç—Ç–æ–º—É proactive wakeup –Ω–µ –≤–∏–¥–µ–Ω

---

## üìà –ê–ù–ê–õ–ò–ó –õ–û–ì–û–í WATCHDOG

### –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è:

```
00:33:41 - Watchdog –∑–∞–ø—É—â–µ–Ω (–∏–Ω—Ç–µ—Ä–≤–∞–ª: 5.0s)
00:38:21 - Health check timeout (1-—è –Ω–µ—É–¥–∞—á–∞ –∏–∑ 56 –ø—Ä–æ–≤–µ—Ä–æ–∫)
00:38:21 - –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è ComfyUI
00:39:05 - Health check failed, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ
```

**–ê–Ω–∞–ª–∏–∑:**
- Watchdog —Ä–∞–±–æ—Ç–∞–µ—Ç ~4.5 –º–∏–Ω—É—Ç—ã –¥–æ –ø–µ—Ä–≤–æ–π –ø—Ä–æ–±–ª–µ–º—ã
- 56 –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞ ~4.5 –º–∏–Ω—É—Ç—ã = ~5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É ‚úÖ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—É)
- ComfyUI –∑–∞—Å—ã–ø–∞–µ—Ç —á–µ—Ä–µ–∑ ~5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã
- Watchdog –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–±—É–¥–∏—Ç—å

---

## üîß –í–ù–ï–°–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. Window Waker - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Ç–∏–ø–æ–≤
**–§–∞–π–ª:** `comfyui_window_waker.py`

**–ë—ã–ª–æ:**
```python
EnumWindowsProc = ctypes.WINFUNCTYPE(
    ctypes.c_bool,
    ctypes.POINTER(ctypes.c_int),  # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø
    ctypes.POINTER(ctypes.c_int)   # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø
)
```

**–°—Ç–∞–ª–æ:**
```python
EnumWindowsProcType = ctypes.WINFUNCTYPE(
    ctypes.c_bool,
    ctypes.wintypes.HWND,    # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø
    ctypes.wintypes.LPARAM   # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Window Waker —É—Å–ø–µ—à–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç –æ–∫–Ω–æ ComfyUI

---

### 2. Watchdog - —É–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–§–∞–π–ª:** `comfyui_watchdog.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- `logger.debug("Proactive wakeup...")` ‚Üí `logger.info("Proactive wakeup...")`
- –¢–µ–ø–µ—Ä—å proactive wakeup –±—É–¥–µ—Ç –≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –†–ê–ë–û–¢–´

### Watchdog (–∑–∞ ~5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã):
- **–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–æ–∫:** 56+
- **–£—Å–ø–µ—à–Ω—ã—Ö:** 55+
- **–ù–µ—É–¥–∞—á–Ω—ã—Ö:** 1-2
- **Success rate:** ~98%

### Window Waker:
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- **–ù–∞—Ö–æ–¥–∏—Ç –æ–∫–Ω–æ:** –î–∞ (HWND: 10486688)

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Window Waker –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ start_for_telegram_processing.bat
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 10-15 –º–∏–Ω—É—Ç:
- `logs/comfyui/watchdog.log` - –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å "Proactive wakeup" –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- `logs/comfyui/waker.log` - –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫
- `logs/worker/runtime.log` - –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å "Proactive ComfyUI wakeup" –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
2. –°–ª–µ–¥–∏—Ç—å –∑–∞ –≤—Ä–µ–º–µ–Ω–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ (>1 –º–∏–Ω—É—Ç—ã)

---

## ‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

1. **ComfyUI –≤—Å–µ –µ—â–µ –∑–∞—Å—ã–ø–∞–µ—Ç**
   - Watchdog –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É
   - –ü—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–±—É–¥–∏—Ç—å
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–º–æ–≥–∞–µ—Ç –ª–∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ

2. **Proactive wakeup –Ω–µ –≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∏–∑–º–µ–Ω–µ–Ω —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å DEBUG –Ω–∞ INFO

3. **Window Waker –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è Windows API

---

## ‚úÖ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ Window Waker
2. ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ proactive wakeup
3. ‚è≥ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
4. ‚è≥ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
5. ‚è≥ **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ** –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã, –≥–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
